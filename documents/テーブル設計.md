# テーブル設計

以下は AI に出力させたたたき台。
最終的には `app/domain/model/model.go` の内容を参照のこと。

## 1. domain テーブル（サイトURLや分類の管理）

カラム名 型 説明
id SERIAL PRIMARY KEY ID
site_name TEXT サイト名
domain varchar(100) サイトのドメイン（例: example.com）
category varchar(100) サイト分類（例: 行政/ニュース/技術ブログなど）
is_active BOOLEAN クロール対象かどうか
created_at TIMESTAMP 登録日時
updated_at TIMESTAMP 更新日時
deleted_at TIMESTAMP 削除日時

## 2. pages テーブル（クロールしたページ単位で管理）

カラム名 型 説明
id SERIAL PRIMARY KEY ID
source_id INT sources.id への外部キー
url TEXT 実際にクロールしたURL
title TEXT ページのタイトル
html TEXT 生HTML（圧縮 or gzip保存推奨）
last_fetched_at TIMESTAMP 最終クロール日時
status_code INT HTTPステータスコード

## 3. chunks テーブル（ページをチャンクに分割し、LLM検索用に保存）

カラム名 型 説明
id SERIAL PRIMARY KEY チャンクID
page_id INT pages.id 外部キー
chunk_index INT ページ内での順序（0から開始）
heading_path TEXT 見出しのパス（例: h1 > h2 > h3）
text TEXT 抽出されたテキスト内容
token_count INT トークン数（LLM向け分割サイズ管理用）

## 4. embeddings テーブル（ベクトルデータ保存）

カラム名 型 説明
id SERIAL PRIMARY KEY ベクトルID
chunk_id INT chunks.id への外部キー
embedding VECTOR(1536) OpenAI や Cohere などで得たベクトル
model_name TEXT 使用モデル名（例: openai-ada-002）
created_at TIMESTAMP 作成日時

VECTOR(1536) は pgvector 拡張を使うことで PostgreSQL に追加可能です。

## 5. search_logs テーブル（検索履歴の記録）

カラム名 型 説明
id SERIAL PRIMARY KEY ログID
query TEXT 検索クエリ
matched_chunk_ids INT[] 一致したチャンクのID（上位10など）
timestamp TIMESTAMP 実行時刻
