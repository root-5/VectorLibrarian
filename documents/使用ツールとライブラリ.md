# 使用ツールとライブラリ

## プロジェクト全体で使用

### Gemini CLI

インストール：`npm install -g @google/gemini-cli`

<https://github.com/google-gemini/gemini-cli/blob/main/docs/cli/configuration.md>
<https://zenn.dev/schroneko/articles/gemini-cli-tutorial>

### TablePlus

Postgres に INSERT したデータを確認する際に使用した GUI ツール。
.env, compose.yml にある DB 接続情報を使って接続する。「SSL mode」は「DISABLE」で設定。

**バックアップ作成**
基本的には Postgres の `pg_dump` コマンドを使うが、TablePlus でも可能。

1. 全データを選択して右クリックを押下
2. 「Export」を選択
3. 「Export as SQL」を選択
4. 「Export」を選択

## app コンテナで使用

### html-to-markdown

最初は単純な変換だと甘く見て自力での実装をしていたが、a タグなどが複雑なネストを形成したりして自前の変換器程度では対応できないことが多く、結局このライブラリを使うことにした。
[HTMLをMarkdownに変換 "html-to-markdown"](https://pkg.go.dev/github.com/JohannesKaufmann/html-to-markdown/v2#section-documentation)

### colly

複数検討した中では、懇意会の用途に一番合っていそうだったので採用。
[スクレイピング "colly"](https://pkg.go.dev/github.com/gocolly/colly#section-documentation)

**使い方**
イベントを登録して、特定の HTML 要素が見つかった時に処理を実行するといった記述方法。

- `OnHTML`: 指定した要素が見つかった時に処理を実行したい
- `OnError`: リクエストでエラーが発生した時に処理を実行したい
- `OnRequest`: 全てのリクエストで処理を実行したい
- `OnResponse`: 全てのレスポンスで処理を実行したい

**OnHTML 内の記述例**
主要な要素を取得するための記述例。

```go
textContent := e.DOM.Text() // テキストコンテンツを取得
html, err := e.DOM.Html() // HTMLを取得
```

**挙動の理解**
気になった挙動を確認したのでメモ。

- デフォルトで一回クロールしたページはキャッシュから取得される
- `c.OnHTML("a[href]" ... c.Visit(e.Attr("href"))` でリンクをたどった場合、そのページ内で見つかった最初のリンクを訪問するためすべてのリンクを最初に取得するわけではない？
- 現在は全件取得している

### Bun

ここでいう Bun は Go の ORM であり、JavaScript のランタイムではない。
重厚な ORM ではなく、軽量な ORM としての位置付けなので使いやすそう。

- [モデル定義](https://bun.uptrace.dev/guide/models.html)
- [使用例](https://github.com/uptrace/bun/tree/master/example)

注意点としては、以下の点がある。

- プライマリキー、複合ユニークに指定したカラムは自動的にインデックスが張られる
- 型を指定しない全て VACHAR になるので注意、モデルの構造体定義時に一緒に指定する

## nlp コンテナで使用

正直に言って、「なんか良いらしい」と「動けばよし」で選んだ。
直接外部公開しない点や進歩が激しすぎて入れ替わる可能性が高い点を考慮して、あまり深く調べていない。

### uv

[uv](https://docs.astral.sh/uv) は Python の開発環境を簡単に構築できるツール。
Rust 製で速度が速く、最近採用が増えていそう。ちゃんと比較はしていないもののかなり早く動いている印象がある。

### uvicorn & FastAPI

[FastAPI](https://fastapi.tiangolo.com/) は Python の Web フレームワークで、API 開発に特化している。
[uvicorn](https://www.uvicorn.org/) は FastAPI の ASGI サーバーで、非同期処理をサポートしている。
Python の軽量な API を作成するときに便利そう。記述も見やすく簡単。

### neologdn

[neologdn](https://github.com/ikegami-yukino/neologdn?tab=readme-ov-file) は日本語の正規化ツール。
日本語のテキストを正規化するためのツールで、全角半角の変換や全角スペースの削除などを行う。

### libonnxruntime.so

onnxruntime.so は以下をビルドしたものの一部？onnxモデルを動かすために必要。gitで以下の公式を落としてきてビルドしたり、pipを使ってインストールする必要ことも可能だが、コンテナでの利用だと重たくなるのでリリースのほうから対象バイナリを含んだtgzをダウンロードして解凍するのが良さそう。
リリースバージョンによってAssetsに含まれるOSの種類やGPUの有無などが異なるのでほしい物がない場合は過去バージョンを探す必要がある。
今回は linux x64 gpu なし（onnxruntime-linux-x64-1.22.0.tgz）を使用する。
<https://github.com/microsoft/onnxruntime>
<https://github.com/microsoft/onnxruntime/releases>
